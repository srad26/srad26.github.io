##lme4##

install.packages("lme4")
tools::package_dependencies("Matrix", which = "LinkingTo", reverse = TRUE)
utils::install.packages("lme4", type = "source")
install.packages("car")
install.packages("lmerTest")
install.packages("writexl")

##load libraries
library("lmerTest")
library("Matrix")
library("devtools"); install_github("lme4/lme4",dependencies=TRUE)
library("car")
library("lme4")
library("writexl")
## setworking directory 

##Load data and variables
DATA <- read.table((file.choose()), header=T, sep="\t")
DATA <-(na.omit(DATA))
head(DATA)
variable<-DATA$DaysAfterPlanting_RB8
Material<-DATA$Material
Rep<-DATA$Rep
Project<-DATA$Location

#all effects are random
Model=lmer(variable ~ (1|Material)+(1|Material:Project)+(1|Project)+(1|Rep), data=DATA, REML=TRUE)
ANOVA<-capture.output(ranova(Model))
dfANOVA<-data.frame(ANOVA)
Summary<-capture.output(summary(Model))
dfSummary<-data.frame(Summary)
capture.output(Model,file="Model_AllRandom_SAMNAM_DAP.txt", options(max.print = .Machine$integer.max))
capture.output(ANOVA, file="ANOVA_SAMNAM_Protein.txt")
capture.output(Summary, file="Summary_SamNAM_Protein.txt", options(max.print = .Machine$integer.max))


#material as fixed
Model=lmer(variable ~ Material+(1|Material:Project)+(1|Project)+(1|Rep), data=DATA, REML=TRUE)
ANOVA<-anova(Model)
Summary<-summary(Model, cor=FALSE)
BLUP<-capture.output(ranef(Model, cor=FALSE))
BLUP=data.frame(BLUP)
ANOVA=data.frame(ANOVA)
Summary=data.frame(Summary)
capture.output(Model,file="Model_MatFixed_SAMNAM_DaysAfterPlanting.txt", options(max.print = .Machine$integer.max))
capture.output(BLUP, file="BLUP_SAMNAM_DaysAfterPlanting.txt", options(max.print = .Machine$integer.max))
capture.output(Summary, file="Summary_SAMNAM_DaysAfterPlanting.txt", options(max.print = .Machine$integer.max))
capture.output(ANOVA, file="ANOVA=MatFixed_SAMNAM_DaysAfterPlanting.txt", options(max.print = .Machine$integer.max))

#################################################
DATA <- read.table((file.choose()), header=T, sep="\t")
#attach(DATA)
DATA <-(na.omit(DATA))
head(DATA)
variable<-DATA$Protein
Material<-DATA$Material
Rep<-DATA$Rep
Project<-DATA$Project

iteration <- 39
ii<- DATA$Protein

for (ii in 10:ncol(DATA)){
  Model = lmer(ii ~ Material + (1|Material:Project)+(1|Project)+(1|Rep), data=DATA)
  Summary <-summary(Model)
  ANOVA<- anova(Model)
  #DATABLUP_output <- ranef(Model)
  #DATABLUP_output
  AN<-capture.output(ANOVA, "ANOVA_SAMNAM.txt")
  #SumDATA <- summary(Summary)
  SM<-capture.output(Summary, file = "Summary_SAMNAM.txt")
  #write.table(DATABLUP_output,"DATABLUP_output.txt")
  rbind(AN,SM)
}

#detach(DATA)
